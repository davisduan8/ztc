
<!--end -->
<script type="text/javascript">
var img_id_upload=new Array();//初始化数组，存储已经上传的图片名
var i=0;//初始化数组下标
$(function() {
    $('#file_upload').uploadify({
    	'auto'     : false,//关闭自动上传
    	//'removeTimeout' : 10,//文件队列上传完成1秒后删除
		'removeCompleted' : true,
        'swf'      : '<?php echo Yii::app()->request->baseUrl; ?>/images/uploadify.swf',
       // 'uploader' : '<?php echo Yii::app()->request->baseUrl; ?>/public/uploadify',
        'method'   : 'post',//方法，服务端可以用$_POST数组获取数据
        'buttonImage' : '<?php echo Yii::app()->request->baseUrl; ?>/images/text_sr_04.jpg',
        'width' : '128',
        'height' : '49',
        'buttonText' : '选择附件',//设置按钮文本
        'multi'    : true,//允许同时上传多张图片
        'uploadLimit' : 100,//一次最多只允许上传100张图片
        'fileTypeDesc' : 'All Files',//只允许上传图像
        'fileTypeExts' : '*.gif; *.jpg; *.png; *.bmp; *.rar; *.docx; *.doc; *.zip; *.pdf',//限制允许上传的图片后缀
        'fileSizeLimit' : '1024000KB',//限制上传的图片不得超过1000M 
        'onUploadSuccess' : function(file, data, response) {//每次成功上传后执行的回调函数，从服务端返回数据到前端
            alert('333333333333333');
               img_id_upload[i]=data;
               i++;
			   getResult(data);
        },
        'onQueueComplete' : function(queueData) {//上传队列全部完成后执行的回调函数
        }  
    });
});

</script>
<script type="text/javascript">
	 function getResult(content){
	 //通过上传的图片来动态生成text来保存路径
	 var board = document.getElementById("divTxt");
	 board.style.display="";
	 var newInput = document.createElement("input");
	 newInput.type = "hidden";
	 newInput.size = "45";
	 newInput.name="uploadpath[]";
	 var obj = board.appendChild(newInput);
	// var br= document.createElement("br");
	// board.appendChild(br);
	 obj.value=content;
 
	 var pos=obj.value.lastIndexOf(".");
	 //截取点之后的字符串
	 var su = obj.value.substring(pos+1);
	 //alert(su);
	 function IsInArray(arr,val){
		var testStr=','+arr.join(",")+",";
		return testStr.indexOf(","+val+",")!=-1;
	 }
	 var arr=['jpg','gif','JPG','PNG','png','bmp'];
	 var arr2=['rar','zip','RAR','ZIP'];
	 var arr3=['docx','doc'];
	 var arr4=['pdf','PDF'];
	 //alert(arr.Exists(su));
	 var boards = document.getElementById("divTxt");
	 boards.style.display="";
	 var newInputs = document.createElement("img");
	 //newInputs.width = "50";
	 newInputs.height = "50";
	 newInputs.name="myFilePaths[]";
	 var objs = boards.appendChild(newInputs);
	 
	 if (IsInArray(arr,su)){
	 objs.src="/uploads/"+content;
	 }else if(IsInArray(arr2,su)){
	 objs.src="/Public/images/rar.jpg";
	 }else if(IsInArray(arr3,su)){
	 objs.src="/Public/images/doc.jpg";
	 }else if(IsInArray(arr4,su)){
	 objs.src="/Public/images/pdf.jpg";
	 }else{
	 objs.src="/Public/images/its.jpg";
	 }
	 //描述上传附件的文字输入框
	 var boarddes = document.getElementById("divTxt");
	 boarddes.style.display="";
	 var newInputdes = document.createElement("input");
	 newInputdes.type = "text";
	 newInputdes.size = "45";
	 newInputdes.id="imgdes";
	 newInputdes.name="imgdes[]";
	 newInputdes.placeholder="标题";
	 newInputdes.value="";
	 var objdes = boarddes.appendChild(newInputdes);
	 //objdes.value='标题：';
	 var brdes= document.createElement("br");
	 boarddes.appendChild(brdes);
 }

 </script>
 <script type="text/javascript">
 //jquery 自动过滤表单输入框前后空格 
 $(document).ready(function() {
     $('#form1 input').keyup(trimkeyup);
	});
 $(document).ready(function() {
     $('#form1 textarea').keyup(trimkeyup);
	});
	function trimkeyup(e) {
		lucene_objInput = $(this);
		if (e.keyCode != 38 && e.keyCode != 40 && e.keyCode != 13) {
		 var im = $.trim(lucene_objInput.val());
		lucene_objInput.val(im); 
		}
	}   
	
 </script>

<style type="text/css">
/* 单选按钮*/
  input[type=radio] {-webkit-appearance: none;appearance: none; width: 13px; height: 13px; margin: 0; cursor: pointer; vertical-align: bottom; background: #fff; border: 1px solid #AED9FC; -webkit-border-radius: 1px; -moz-border-radius: 1px; border-radius: 1px; -webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; position: relative; }
  input[type=radio]:active { border-color: #2376B9; background: #AED9FC; }
  input[type=radio] { -webkit-border-radius: 1em; -moz-border-radius: 1em; border-radius: 1em; width: 15px; height: 15px; }
  input[type=radio]:checked { background: #fff; }
  input[type=radio]:checked::after { content: '';  display: block;  position: relative;  top: 3px;  left: 3px;  width: 7px;  height: 7px;  background: #2376B9;  -webkit-border-radius: 1em;  -moz-border-radius: 1em;  border-radius: 1em;  }
  
.jyhz_text_box_r,.jyhz_text_box_r2,.jyhz_text_box_r3,.jyhz_text_box_r4{color:#999999;}
.kz input{ margin-top:10px;}
.zjwz{position:relative;}
.jyhz_text_box_r2_d{width:713px;height:72px; line-height:72px;float:right;color:#555;font-size:16px;font-family:"Microsoft Yahei";}
.agebg{background:url(__PUBLIC__/images/text_sr_02_d.jpg) left top no-repeat; width:60px; height:48px; line-height:48px; border:0px; padding-left:10px;}
.onShow,.onFocus,.onError,.onEmpty,.onCorrect{font-size:12px; color:#F64204;}



/* 选择专家层*/
.box{position:absolute;width:800px;left:50%;height:auto;z-index:100;background-color:#fff;border:1px #56BCDA solid;padding:1px;}
.box h2{height:25px;font-size:14px;background-color:#2376BA;position:relative;padding-left:10px;line-height:25px;color:#fff;}
.box h2 a{position:absolute;right:5px;font-size:12px;color:#fff;}
.box .mainlist{padding:10px;}
.bumen{width:95%; white-space:nowrap; line-height:25px;}
.bumen li{float:left; width:90px;}
#TB_overlayBG{background-color:#EFEFEF;position:absolute;z-index:99;left:0;top:0;display:none;width:100%;height:100%;opacity:0.5;filter: alpha(opacity=50);-moz-opacity: 0.5;}

.fanhui_d{float:right;}
.fanhui_d a{color:#FF0000;}
.bigpage{height:25px; line-height:25px; font-size:14px; margin-top:15px;}
.bigpage a{margin-left:10px; margin-right:10px; border:1px solid #CCC; background-color:#EFEFEF; padding:5px;}

.normaltips {border: none; padding: 2px; margin:10px;}
.errortips {border: 1px solid #fcefa1; background-color:#FCFAEF; padding:10px;font-size:12px;color:red;}
.correcttips {border: 1px solid green; background-color:#FFFFFF;}
.lhei{line-height:48px;}



.validatebox-tip{
	position:absolute;
	width:200px;
	height:auto;
	display:none;
	z-index:9900000;
}
.validatebox-tip-content{
	display:inline-block;
	position:absolute;
	top:5px;
	left:10px;
	padding:10px 5px;
	border:1px solid #fcefa1;
	background:#FCFAEF;
	z-index:9900001;
	font-size:12px;
}
</style>

<!--fj -->
<?php 
/**
 *定义数组使radio的样式不用换行
 */		
$tplarray=array('template'=>'{input} {label}','separator'=>'&nbsp;&nbsp;');
?>

<div class="box_ri_con">

<?php $form=$this->beginWidget('CActiveForm',array('id'=>'Mform','htmlOptions'=>array('name'=>'Mform','enctype'=>'multipart/form-data')));  ?>

	<?php echo CHtml::errorSummary($model); ?>
<table class="table1" width="0" border="0">
        <tr>
            <td align="right" valign="middle"> 上传附件:</td>
            <td>
              <a href="javascript:uploadifyAction('fileListWarp')" >
              <img src="<?php echo Yii::app()->request->baseUrl;?>/images/create.gif" align="absmiddle">添加图片</a>
            </td>
        </tr>

      <tr>
	    <td align="right" valign="middle"> 病例资料:</td>
            <td><?php echo CHtml::activeFileField($model, 'hzfj'); ?></td>
           
	    <td colspan="3">&nbsp;</td>
	</tr>
      
          <tr>
           <?php if(!empty($model->hzfj)):?>
            
              <td align="right" valign="middle">   <?php echo CHtml::label('图片预览','') ?></td>
              <td>   <a href="<?php echo Yii::app()->basePath.'/../upload/'. $model->hzfj?>" target="_blank"> <?php echo '<img src="http://localhost/yiiztc/./upload/'.$model->hzfj.'" style="width:230px; height:230px;" />'; ?></a></td>
     
        <?php endif;?>
        </tr>
   

</table>
    
    
        <div class="jyhz_text_box_l4">上传图片：</div>
            <div class="jyhz_text_box_r4">
                    <!--<div class="tjfj_btn" id="addbtn"></div> -->
                            <!--upload -->
            <div id="divTxt" style="display:none;"><br>  
            </div><br><!-- 这是上传的文件 -->
	   <input type="file" name="file_upload" id="file_upload" /> 
                <input type="file" name="file_upload" id="file_upload" /> 
                    <ul class="up-bg">
                    <li><a href="javascript:$('#file_upload').uploadify('upload','*')">上 传</a></li>
                    <li><a href="javascript:$('#file_upload').uploadify('cancel','*')">取 消</a></li>
                    </ul>

            <div class="clear"></div>
                
<div class="row buttons" style="text-align:center;">
        <?php echo CHtml::submitButton($model->isNewRecord ? '下一步' : '保存'); ?>&nbsp;&nbsp;
         <input class="button" value="重填" name="reset" type="reset">
</div>

<?php $this->endWidget(); ?>

</div>